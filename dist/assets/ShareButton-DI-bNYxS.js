import{r as C,j as d,h as D,x as O,y as I}from"./vendor-C1Ycd6jf.js";import{u as L,f as H}from"./index-DAmZMeQi.js";const h=32,g=340,E=200,N="16px 'Noto Sans Arabic', 'Tajawal', sans-serif",A="18px 'Amiri', 'Noto Naskh Arabic', serif",B="12px 'Noto Sans Arabic', 'Tajawal', sans-serif",y="#D4A84B",_="#F3EDE0",k="#7E87AA";function F(e,n,i,r){e.save(),e.font=r,e.direction="rtl";const o=[],a=n.split(/\s+/).filter(Boolean);let t="";for(let s=a.length-1;s>=0;s--){const l=a[s],c=t?l+" "+t:l;e.measureText(c).width>i&&t?(o.push(t),t=l):t=c}return t&&o.push(t),e.restore(),o}function R(e,n,i,r,o,a){e.beginPath(),e.moveTo(n+a,i),e.lineTo(n+r-a,i),e.quadraticCurveTo(n+r,i,n+r,i+a),e.lineTo(n+r,i+o-a),e.quadraticCurveTo(n+r,i+o,n+r-a,i+o),e.lineTo(n+a,i+o),e.quadraticCurveTo(n,i+o,n,i+o-a),e.lineTo(n,i+a),e.quadraticCurveTo(n,i,n+a,i),e.closePath()}function $(e){const{title:n,body:i,source:r=""}=e,o=document.createElement("canvas"),a=Math.min(2,window.devicePixelRatio||1),t=o.getContext("2d");if(!t)return Promise.reject(new Error("Canvas not supported"));const s=g-h*2;o.width=g*a,o.height=E*a,t.scale(a,a),t.font=A,t.direction="rtl";const l=F(t,i,s,A),c=32,f=l.length*c,p=24,v=r?20:0,m=Math.max(E,h*2+p+12+f+(r?12+v:0));o.height=m*a,t.scale(a,a),t.clearRect(0,0,g,m);const u=g,T=m,b=t.createLinearGradient(0,0,u,T);b.addColorStop(0,"#111936"),b.addColorStop(1,"#172049"),R(t,0,0,u,T,20),t.fillStyle=b,t.fill(),t.strokeStyle=y+"40",t.lineWidth=1,R(t,0,0,u,T,20),t.stroke(),t.font=N,t.fillStyle=y,t.textAlign="center",t.textBaseline="middle",t.direction="rtl",t.fillText(n,u/2,h+p/2),t.font=A,t.fillStyle=_,t.textAlign="center";let S=h+p+12+c/2;for(const w of l)t.fillText(w,u/2,S),S+=c;return r&&(t.font=B,t.fillStyle=k,t.fillText("— "+r,u/2,S+12+v/2)),new Promise((w,j)=>{o.toBlob(x=>x?w(x):j(new Error("toBlob failed")),"image/png",.92)})}async function P(e){const{title:n,text:i,source:r}=e,o=r?`"${i}"
— ${r}
${n}`:`"${i}"
${n}`;if(navigator.share)try{return await navigator.share({title:n,text:o}),!0}catch(a){if(a.name==="AbortError")return!1}try{return await navigator.clipboard.writeText(o),!0}catch{return!1}}async function U(e){const n=await $({title:e.title,body:e.text,source:e.source}),i=new File([n],"hadith.png",{type:"image/png"});if(navigator.share&&navigator.canShare?.({files:[i]}))try{return await navigator.share({title:e.title,files:[i]}),!0}catch(a){if(a.name==="AbortError")return!1}const r=URL.createObjectURL(n),o=document.createElement("a");return o.href=r,o.download="hadith.png",o.click(),setTimeout(()=>URL.revokeObjectURL(r),100),!0}function M({content:e,label:n="مشاركة",compact:i=!0,style:r={}}){const o=L(),[a,t]=C.useState(!1),[s,l]=C.useState(null),c=async f=>{l(f);try{f==="text"?await P(e):await U(e),t(!1)}finally{l(null)}};return d.jsxs(d.Fragment,{children:[d.jsxs("button",{type:"button",onClick:()=>t(!0),disabled:s!==null,"aria-label":n,style:{display:"inline-flex",alignItems:"center",justifyContent:"center",gap:6,padding:i?"8px 10px":"10px 14px",borderRadius:12,border:`1px solid ${o.gold}35`,background:`${o.gold}0C`,color:o.gold,fontSize:12,fontWeight:600,fontFamily:H,cursor:s?"wait":"pointer",opacity:s?.7:1,transition:"all .2s",...r},children:[d.jsx(D,{icon:O,style:{fontSize:18}}),!i&&d.jsx("span",{children:n})]}),d.jsx(I,{isOpen:a,onDidDismiss:()=>t(!1),header:n,buttons:[{text:"مشاركة كنص (واتساب، رسالة…)",icon:"chatbubble-outline",handler:()=>c("text")},{text:"مشاركة كصورة (ستوري، حفظ صورة)",icon:"image-outline",handler:()=>c("image")},{text:"إلغاء",role:"cancel"}]})]})}export{M as S};
