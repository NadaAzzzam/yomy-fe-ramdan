import{r as h}from"./vendor-BiHAOAa9.js";const S="https://dorar.net/dorar_api.json",x="https://api.allorigins.win/raw?url=",B="yomy-dorar:",V=30*24*60*60*1e3,z=["صحيح","إسناده صحيح","أخرجه في صحيحه","رجال أحمد رجال الصحيح","إسناده صحيح على شرط مسلم"],J=["ضعيف","موضوع","لا يصح","منكر","مُنكر"];function F(e){return B+encodeURIComponent(e.trim())}function K(e){try{const t=localStorage.getItem(F(e));if(!t)return null;const{exp:n,data:a}=JSON.parse(t);return Date.now()>n?null:a}catch{return null}}function b(e,t){try{const n=Date.now()+V;localStorage.setItem(F(e),JSON.stringify({exp:n,data:t}))}catch{}}function X(e,t=8){return!e||typeof e!="string"?"":e.replace(/\s+/g," ").replace(/[\u064B-\u065F\u0670]/g,"").trim().split(/\s+/).filter(Boolean).slice(0,t).join(" ")}function Q(e){if(!e||typeof e!="string")return{verified:!1,detail:"empty"};const t=e.split(/---------\s*/);for(const n of t){const a=n.match(/خلاصة\s+حكم\s+المحدث[:\s]*<\/span>\s*([^<]+)/i)||n.match(/خلاصة\s+حكم\s+المحدث[^>]*>([^<]+)/i),r=a?a[1].trim():"";if(!r)continue;const s=r;if(J.some(u=>s.includes(u)))continue;if(z.some(u=>s.includes(u)))return{verified:!0,detail:r}}return{verified:!1,detail:"no_sahih_ruling"}}async function W(e){const t=`skey=${encodeURIComponent(e)}`,n=`${S}?${t}`,a=async(r,s)=>fetch(r,{...s,headers:{Accept:"application/json","User-Agent":"Mozilla/5.0 (compatible; YomyApp/1)",...s?.headers}});try{const r=await a(n);if(r.ok)return r.json()}catch{}try{const r=await a(x+encodeURIComponent(n));if(!r.ok)return null;const s=await r.text();try{return JSON.parse(s)}catch{return null}}catch{return null}}async function N(e){const t=X(e);if(!t)return{verified:!1,detail:"empty_skey"};const n=K(t);if(n!==null)return n;try{const a=await W(t);if(!a){const o={verified:!1,detail:"network_error"};return b(t,o),o}const r=a?.ahadith?.result??"",s=Q(r);return b(t,s),s}catch(a){const r={verified:!1,detail:a instanceof Error?a.message:"network_error"};return b(t,r),r}}function A(e){if(!e)return!1;const t=e.trim();return t.includes("البخاري")||t.includes("مسلم")||t.includes("متفق عليه")||t.includes("أخرجه البخاري")||t.includes("صحيح البخاري")||t.includes("صحيح مسلم")||t.includes("صحيح الجامع")||t.includes("صحيح ابن حبان")||t.includes("إسناده صحيح")}const T="yomy-dorar-tafsir:",Y=7*24*60*60*1e3,g=520,q=2,v=["الراوي:","المحدث:","المصدر:","الصفحة أو الرقم:","خلاصة حكم المحدث:","الإسناد:"];function G(e){if(!e||typeof e!="string")return null;const t=e.replace(/<[^>]+>/g," ").replace(/\s+/g," ").trim();if(t.length<20||t.split("خلاصة حكم المحدث").length>2||v.reduce((s,o)=>s+(t.includes(o)?1:0),0)>q)return null;let r=t;for(const s of v){const o=r.indexOf(s);o!==-1&&(r=r.slice(0,o).trim())}if(r=r.replace(/\s+/g," ").trim(),r.length<25)return null;if(r.length>g){r=r.slice(0,g+1);const s=Math.max(r.lastIndexOf("."),r.lastIndexOf("۔"),r.lastIndexOf("،"));s>g/2?r=r.slice(0,s+1).trim():r=r.slice(0,g).trim()}return r.length>=25?r:null}async function yt(e,t){const n=`${e}_${t}`,a=Z(n);if(a!==void 0)return a.length>0?a:null;const r=`${e}_${t}`,s=`skey=${encodeURIComponent(r)}`,o=typeof import.meta<"u"&&!1,u=`${S}?${s}`;try{let c;if(!o)try{c=await fetch(`${S}?${s}`,{headers:{Accept:"application/json"}})}catch{c=await fetch(x+encodeURIComponent(`${S}?${s}`))}if(!c.ok)return p(n,""),null;const i=await c.json(),f=i?.tafaseer?.result??i.tafsir??i?.ahadith?.result??i?.result??"";if(!f||typeof f!="string")return p(n,""),null;const d=G(f);return d?(p(n,d),d):(p(n,""),null)}catch{return p(n,""),null}}function Z(e){try{const t=localStorage.getItem(T+e);if(!t)return;const{exp:n,text:a}=JSON.parse(t);return Date.now()>n?void 0:a}catch{return}}function p(e,t){try{const n=Date.now()+Y;localStorage.setItem(T+e,JSON.stringify({exp:n,text:t}))}catch{}}const tt=["صلاة الرغائب","بدعة","بدعي","مبتدع","مبتدعة","أهل البدع","الاحتفال بالمولد","ذكر جماعي بصيغة واحدة بعد الصلاة"],et=["وصدق الله العظيم","صدق الله العظيم","و صدق الله العظيم","، وصدق الله العظيم","، صدق الله العظيم"];function I(e){if(e==null||typeof e!="string")return!0;const t=e.trim().replace(/\s+/g," ");for(const n of tt)if(t.includes(n))return!1;return!0}function U(e){if(e==null||typeof e!="string")return"";let t=e.trim().replace(/\s+/g," ");for(const n of et){const a=n.trim();if(t.endsWith(a)){t=t.slice(0,-a.length).trim();break}}return t}const nt="https://cdn.jsdelivr.net/gh/fawazahmed0/hadith-api@1",E="yomy-api-cache:";function k(e,t){try{const n=localStorage.getItem(E+e);return n?(t!=null&&Date.now()>t,JSON.parse(n)):null}catch{return null}}function _(e,t,n){try{const a=n!=null?{_exp:n,data:t}:t;localStorage.setItem(E+e,JSON.stringify(a))}catch{}}function w(e){try{const t=localStorage.getItem(E+e);if(!t)return null;const n=JSON.parse(t);return n._exp!=null&&Date.now()>n._exp?null:n.data??n}catch{return null}}function L(){const e=new Date;return e.setHours(23,59,59,999),e.getTime()}function mt(e){return e?e.replace(/<br\s*\/?>/gi,`
`).replace(/<[^>]+>/g,""):""}async function j(e="ara-bukhari",t=1){const n=`hadith:${e}:${t}`,a=k(n);if(a?.text&&I(a.text))return a;try{const r=`${nt}/editions/${e}/${t}.min.json`,s=await fetch(r);if(!s.ok)return null;const o=await s.json(),u=o?.hadiths?.[0]?.text??"",c=o?.metadata?.name??e;if(!I(u))return null;const i={text:u,source:c};return _(n,i),i}catch{return k(n)}}function rt(e,t=1500){return e%t+1}function pt(e,t){const[n,a]=h.useState(()=>({...t[e%t.length],dorarVerified:void 0})),[r,s]=h.useState(!0),[o,l]=h.useState(null);return h.useEffect(()=>{let u=!1;s(!0),l(null);const c=rt(e);return j("ara-bukhari",c).then(i=>{if(!u){if(i?.text){const f=A(i.source);a({...i,dorarVerified:f}),l(f?!0:null)}else{const f=t[e%t.length];a({...f,dorarVerified:void 0}),l(null)}s(!1)}}),()=>{u=!0}},[e,t]),h.useEffect(()=>{if(!n?.text||r)return;if(A(n.source)){l(!0);return}let u=!1;return N(n.text).then(c=>{u||l(c.verified)}),()=>{u=!0}},[n?.text,n?.source,r]),{hadith:n,loading:r,dorarVerified:o}}const P="https://api.aladhan.com/v1";function H(){const e=new Date,t=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),a=e.getFullYear();return`${t}-${n}-${a}`}async function at(e="Cairo",t="Egypt",n=5){const a=H(),r=`prayer:${a}:city:${e}:${t}:${n}`,s=w(r);if(s)return s;try{const o=`${P}/timingsByCity/${a}?city=${encodeURIComponent(e)}&country=${encodeURIComponent(t)}&method=${n}`,l=await fetch(o);if(!l.ok)return null;const c=(await l.json())?.data?.timings;if(!c)return null;const i=d=>(d??"").replace(/\s*\(.*\)/,"").trim(),f={Fajr:i(c.Fajr),Sunrise:i(c.Sunrise),Dhuhr:i(c.Dhuhr),Asr:i(c.Asr),Maghrib:i(c.Maghrib),Isha:i(c.Isha)};return _(r,f,L()),f}catch{return w(r)}}async function st(e,t,n=5){const a=H(),r=`prayer:${a}:coords:${e.toFixed(4)}:${t.toFixed(4)}:${n}`,s=w(r);if(s)return s;try{const o=`${P}/timings/${a}?latitude=${e}&longitude=${t}&method=${n}`,l=await fetch(o);if(!l.ok)return null;const c=(await l.json())?.data?.timings;if(!c)return null;const i=d=>(d??"").replace(/\s*\(.*\)/,"").trim(),f={Fajr:i(c.Fajr),Sunrise:i(c.Sunrise),Dhuhr:i(c.Dhuhr),Asr:i(c.Asr),Maghrib:i(c.Maghrib),Isha:i(c.Isha)};return _(r,f,L()),f}catch{return w(r)}}function gt(e,t,n,a,r){const[s,o]=h.useState(null),[l,u]=h.useState(!0),[c,i]=h.useState(!1),f=typeof a=="number"&&Number.isFinite(a)&&typeof r=="number"&&Number.isFinite(r);return h.useEffect(()=>{let d=!1;return u(!0),i(!1),(f?st(a,r,n):at(e,t,n)).then($=>{d||($?(o($),i(!1)):i(!0),u(!1))}),()=>{d=!0}},[f,e,t,n,a,r]),{times:s,loading:l,error:c}}function St(e){if(!e||!e.trim())return e;const t=e.trim().split(":"),n=parseInt(t[0]??"0",10),a=parseInt(t[1]??"0",10),r=n===0?12:n>12?n-12:n,s=String(a).padStart(2,"0"),o=n<12?"ص":"م";return`${r}:${s} ${o}`}function At(e){const t=[{key:"Fajr",label:"الفجر"},{key:"Sunrise",label:"الشروق"},{key:"Dhuhr",label:"الظهر"},{key:"Asr",label:"العصر"},{key:"Maghrib",label:"المغرب"},{key:"Isha",label:"العشاء"}],n=new Date,a=n.getHours()*60+n.getMinutes();for(const s of t){const o=e[s.key];if(!o)continue;const[l,u]=o.split(":").map(Number),c=(l??0)*60+(u??0);if(c>a)return{key:s.key,label:s.label,time:o,minutesLeft:c-a}}const r=e.Fajr;if(r){const[s,o]=r.split(":").map(Number),l=(s??0)*60+(o??0),u=24*60-a+l;return{key:"Fajr",label:"الفجر (غداً)",time:r,minutesLeft:u}}return null}const ot="yomy-azan-v1";let y=null,m=null;function C(){return typeof caches>"u"?Promise.resolve(null):caches.open(ot).catch(()=>null)}async function ct(e){const t=await C();if(!t)return null;try{const n=await t.match(e);if(!n||!n.ok)return null;const a=await n.blob();return URL.createObjectURL(a)}catch{return null}}async function wt(e){const t=await C();if(!t)return!1;try{const n=e,a=await fetch(n);return a.ok?(await t.put(e,a),!0):!1}catch{return!1}}async function bt(e){const t=await C();if(!t)return!1;const n=await t.match(e);return n!=null&&n.ok}async function it(e){const t=await ct(e);return t?{url:t,isBlob:!0}:{url:e,isBlob:!1}}function Et(e){return new Promise(t=>{(async()=>{try{R();const{url:n,isBlob:a}=await it(e);a&&(m=n);const r=new Audio(n);r.volume=1,y=r;const s=()=>{r.removeEventListener("error",o),y===r&&(y=null),m===n&&a&&(URL.revokeObjectURL(n),m=null)},o=()=>{s(),R(),t(null)};r.addEventListener("error",o),r.addEventListener("ended",()=>{y===r&&(y=null),m===n&&a&&(URL.revokeObjectURL(n),m=null)}),r.play().then(()=>{r.removeEventListener("error",o),t(r)}).catch(()=>{o()})}catch{t(null)}})()})}function R(){m&&(URL.revokeObjectURL(m),m=null),y&&(y.pause(),y.currentTime=0,y=null)}const ut="https://api.alquran.cloud/v1",M="yomy-quran-page-",lt=604;function D(e){try{const t=localStorage.getItem(M+e);return t?JSON.parse(t):null}catch{return null}}function ft(e){try{localStorage.setItem(M+e.pageNumber,JSON.stringify(e))}catch{}}async function _t(e){if(e<1||e>lt)return null;const t=D(e);if(t)return O(t);if(typeof navigator<"u"&&!navigator.onLine)return null;try{const n=await fetch(`${ut}/page/${e}`);if(!n.ok)return null;const r=(await n.json())?.data?.ayahs;if(!Array.isArray(r))return null;const s={pageNumber:e,ayahs:r.map(o=>({text:U(o.text),numberInSurah:o.numberInSurah,surah:{number:o.surah.number,name:o.surah.name}}))};return ft(s),s}catch{const n=D(e);return n?O(n):null}}function O(e){return{pageNumber:e.pageNumber,ayahs:e.ayahs.map(t=>({...t,text:U(t.text)}))}}function Ct(){const[e,t]=h.useState(typeof navigator<"u"?navigator.onLine:!0);return h.useEffect(()=>{const n=()=>t(!0),a=()=>t(!1);return window.addEventListener("online",n),window.addEventListener("offline",a),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",a)}},[]),e}function $t(e,t){const[n,a]=h.useState(()=>({...t[0],dorarVerified:void 0})),[r,s]=h.useState(!0),[o,l]=h.useState(null);return h.useEffect(()=>{const u=t[e%t.length]??t[0];a({...u,dorarVerified:void 0}),s(!0),l(null);let c=!1;const i=e%42+1;return j("ara-nawawi",i).then(f=>{if(!c){if(f?.text){const d=A(f.source);a({...f,dorarVerified:d}),l(d?!0:null)}else a({...u,dorarVerified:void 0}),l(null);s(!1)}}),()=>{c=!0}},[e,t]),h.useEffect(()=>{if(!n?.text||r)return;if(A(n.source)){l(!0);return}let u=!1;return N(n.text).then(c=>{u||l(c.verified)}),()=>{u=!0}},[n?.text,n?.source,r]),{hadith:n,loading:r,dorarVerified:o}}export{lt as Q,mt as a,$t as b,gt as c,St as d,bt as e,yt as f,At as g,wt as h,A as i,R as j,Ct as k,_t as l,Et as p,U as s,pt as u,N as v};
