import{r as h}from"./vendor-MGWi7VC4.js";const O=["صلاة الرغائب","بدعة","بدعي","مبتدع","مبتدعة","أهل البدع","الاحتفال بالمولد","ذكر جماعي بصيغة واحدة بعد الصلاة"],P=["وصدق الله العظيم","صدق الله العظيم","و صدق الله العظيم","، وصدق الله العظيم","، صدق الله العظيم"];function E(e){if(e==null||typeof e!="string")return!0;const t=e.trim().replace(/\s+/g," ");for(const n of O)if(t.includes(n))return!1;return!0}function _(e){if(e==null||typeof e!="string")return"";let t=e.trim().replace(/\s+/g," ");for(const n of P){const r=n.trim();if(t.endsWith(r)){t=t.slice(0,-r.length).trim();break}}return t}const T="https://dorar.net/dorar_api.json",x="yomy-dorar:",H=30*24*60*60*1e3,B=["صحيح","إسناده صحيح","أخرجه في صحيحه","رجال أحمد رجال الصحيح","إسناده صحيح على شرط مسلم"],M=["ضعيف","موضوع","لا يصح","منكر","مُنكر"];function D(e){return x+encodeURIComponent(e.trim())}function V(e){try{const t=localStorage.getItem(D(e));if(!t)return null;const{exp:n,data:r}=JSON.parse(t);return Date.now()>n?null:r}catch{return null}}function S(e,t){try{const n=Date.now()+H;localStorage.setItem(D(e),JSON.stringify({exp:n,data:t}))}catch{}}function z(e,t=8){return!e||typeof e!="string"?"":e.replace(/\s+/g," ").replace(/[\u064B-\u065F\u0670]/g,"").trim().split(/\s+/).filter(Boolean).slice(0,t).join(" ")}function K(e){if(!e||typeof e!="string")return{verified:!1,detail:"empty"};const t=e.split(/---------\s*/);for(const n of t){const r=n.match(/خلاصة\s+حكم\s+المحدث[:\s]*<\/span>\s*([^<]+)/i)||n.match(/خلاصة\s+حكم\s+المحدث[^>]*>([^<]+)/i),a=r?r[1].trim():"";if(!a)continue;const s=a;if(M.some(c=>s.includes(c)))continue;if(B.some(c=>s.includes(c)))return{verified:!0,detail:a}}return{verified:!1,detail:"no_sahih_ruling"}}async function R(e){const t=z(e);if(!t)return{verified:!1,detail:"empty_skey"};const n=V(t);if(n!==null)return n;try{const r=`${T}?skey=${encodeURIComponent(t)}`,a=await fetch(r,{headers:{Accept:"application/json","User-Agent":"Mozilla/5.0 (compatible; YomyApp/1)"}});if(!a.ok){const c={verified:!1,detail:`http_${a.status}`};return S(t,c),c}const o=(await a.json())?.ahadith?.result??"",u=K(o);return S(t,u),u}catch(r){const a={verified:!1,detail:r instanceof Error?r.message:"network_error"};return S(t,a),a}}function p(e){if(!e)return!1;const t=e.trim();return t.includes("البخاري")||t.includes("مسلم")||t.includes("متفق عليه")||t.includes("أخرجه البخاري")||t.includes("صحيح البخاري")||t.includes("صحيح مسلم")||t.includes("صحيح الجامع")||t.includes("صحيح ابن حبان")||t.includes("إسناده صحيح")}const J="https://cdn.jsdelivr.net/gh/fawazahmed0/hadith-api@1",A="yomy-api-cache:";function k(e,t){try{const n=localStorage.getItem(A+e);return n?(t!=null&&Date.now()>t,JSON.parse(n)):null}catch{return null}}function w(e,t,n){try{const r=n!=null?{_exp:n,data:t}:t;localStorage.setItem(A+e,JSON.stringify(r))}catch{}}function g(e){try{const t=localStorage.getItem(A+e);if(!t)return null;const n=JSON.parse(t);return n._exp!=null&&Date.now()>n._exp?null:n.data??n}catch{return null}}function L(){const e=new Date;return e.setHours(23,59,59,999),e.getTime()}function ae(e){return e?e.replace(/<br\s*\/?>/gi,`
`).replace(/<[^>]+>/g,""):""}async function N(e="ara-bukhari",t=1){const n=`hadith:${e}:${t}`,r=k(n);if(r?.text&&E(r.text))return r;try{const a=`${J}/editions/${e}/${t}.min.json`,s=await fetch(a);if(!s.ok)return null;const o=await s.json(),c=o?.hadiths?.[0]?.text??"",i=o?.metadata?.name??e;if(!E(c))return null;const l={text:c,source:i};return w(n,l),l}catch{return k(n)}}function Q(e,t=1500){return e%t+1}function se(e,t){const[n,r]=h.useState(()=>({...t[e%t.length],dorarVerified:void 0})),[a,s]=h.useState(!0),[o,u]=h.useState(null);return h.useEffect(()=>{let c=!1;s(!0),u(null);const i=Q(e);return N("ara-bukhari",i).then(l=>{if(!c){if(l?.text){const f=p(l.source);r({...l,dorarVerified:f}),u(f?!0:null)}else{const f=t[e%t.length];r({...f,dorarVerified:void 0}),u(null)}s(!1)}}),()=>{c=!0}},[e,t]),h.useEffect(()=>{if(!n?.text||a)return;if(p(n.source)){u(!0);return}let c=!1;return R(n.text).then(i=>{c||u(i.verified)}),()=>{c=!0}},[n?.text,n?.source,a]),{hadith:n,loading:a,dorarVerified:o}}const U="https://api.aladhan.com/v1";function j(){const e=new Date,t=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),r=e.getFullYear();return`${t}-${n}-${r}`}async function W(e="Cairo",t="Egypt",n=5){const r=j(),a=`prayer:${r}:city:${e}:${t}:${n}`,s=g(a);if(s)return s;try{const o=`${U}/timingsByCity/${r}?city=${encodeURIComponent(e)}&country=${encodeURIComponent(t)}&method=${n}`,u=await fetch(o);if(!u.ok)return null;const i=(await u.json())?.data?.timings;if(!i)return null;const l=d=>(d??"").replace(/\s*\(.*\)/,"").trim(),f={Fajr:l(i.Fajr),Sunrise:l(i.Sunrise),Dhuhr:l(i.Dhuhr),Asr:l(i.Asr),Maghrib:l(i.Maghrib),Isha:l(i.Isha)};return w(a,f,L()),f}catch{return g(a)}}async function X(e,t,n=5){const r=j(),a=`prayer:${r}:coords:${e.toFixed(4)}:${t.toFixed(4)}:${n}`,s=g(a);if(s)return s;try{const o=`${U}/timings/${r}?latitude=${e}&longitude=${t}&method=${n}`,u=await fetch(o);if(!u.ok)return null;const i=(await u.json())?.data?.timings;if(!i)return null;const l=d=>(d??"").replace(/\s*\(.*\)/,"").trim(),f={Fajr:l(i.Fajr),Sunrise:l(i.Sunrise),Dhuhr:l(i.Dhuhr),Asr:l(i.Asr),Maghrib:l(i.Maghrib),Isha:l(i.Isha)};return w(a,f,L()),f}catch{return g(a)}}function oe(e,t,n,r,a){const[s,o]=h.useState(null),[u,c]=h.useState(!0),[i,l]=h.useState(!1),f=typeof r=="number"&&Number.isFinite(r)&&typeof a=="number"&&Number.isFinite(a);return h.useEffect(()=>{let d=!1;return c(!0),l(!1),(f?X(r,a,n):W(e,t,n)).then(v=>{d||(v?(o(v),l(!1)):l(!0),c(!1))}),()=>{d=!0}},[f,e,t,n,r,a]),{times:s,loading:u,error:i}}function ie(e){if(!e||!e.trim())return e;const t=e.trim().split(":"),n=parseInt(t[0]??"0",10),r=parseInt(t[1]??"0",10),a=n===0?12:n>12?n-12:n,s=String(r).padStart(2,"0"),o=n<12?"ص":"م";return`${a}:${s} ${o}`}function ce(e){const t=[{key:"Fajr",label:"الفجر"},{key:"Sunrise",label:"الشروق"},{key:"Dhuhr",label:"الظهر"},{key:"Asr",label:"العصر"},{key:"Maghrib",label:"المغرب"},{key:"Isha",label:"العشاء"}],n=new Date,r=n.getHours()*60+n.getMinutes();for(const s of t){const o=e[s.key];if(!o)continue;const[u,c]=o.split(":").map(Number),i=(u??0)*60+(c??0);if(i>r)return{key:s.key,label:s.label,time:o,minutesLeft:i-r}}const a=e.Fajr;if(a){const[s,o]=a.split(":").map(Number),u=(s??0)*60+(o??0),c=24*60-r+u;return{key:"Fajr",label:"الفجر (غداً)",time:a,minutesLeft:c}}return null}const Y="yomy-azan-v1";let y=null,m=null;function b(){return typeof caches>"u"?Promise.resolve(null):caches.open(Y).catch(()=>null)}async function q(e){const t=await b();if(!t)return null;try{const n=await t.match(e);if(!n||!n.ok)return null;const r=await n.blob();return URL.createObjectURL(r)}catch{return null}}async function ue(e){const t=await b();if(!t)return!1;try{const n=e,r=await fetch(n);return r.ok?(await t.put(e,r),!0):!1}catch{return!1}}async function le(e){const t=await b();if(!t)return!1;const n=await t.match(e);return n!=null&&n.ok}async function G(e){const t=await q(e);return t?{url:t,isBlob:!0}:{url:e,isBlob:!1}}function fe(e){return new Promise(t=>{(async()=>{try{$();const{url:n,isBlob:r}=await G(e);r&&(m=n);const a=new Audio(n);a.volume=1,y=a;const s=()=>{a.removeEventListener("error",o),y===a&&(y=null),m===n&&r&&(URL.revokeObjectURL(n),m=null)},o=()=>{s(),$(),t(null)};a.addEventListener("error",o),a.addEventListener("ended",()=>{y===a&&(y=null),m===n&&r&&(URL.revokeObjectURL(n),m=null)}),a.play().then(()=>{a.removeEventListener("error",o),t(a)}).catch(()=>{o()})}catch{t(null)}})()})}function $(){m&&(URL.revokeObjectURL(m),m=null),y&&(y.pause(),y.currentTime=0,y=null)}const Z="https://api.alquran.cloud/v1",F="yomy-quran-page-",ee=604;function C(e){try{const t=localStorage.getItem(F+e);return t?JSON.parse(t):null}catch{return null}}function te(e){try{localStorage.setItem(F+e.pageNumber,JSON.stringify(e))}catch{}}async function he(e){if(e<1||e>ee)return null;const t=C(e);if(t)return I(t);if(typeof navigator<"u"&&!navigator.onLine)return null;try{const n=await fetch(`${Z}/page/${e}`);if(!n.ok)return null;const a=(await n.json())?.data?.ayahs;if(!Array.isArray(a))return null;const s={pageNumber:e,ayahs:a.map(o=>({text:_(o.text),numberInSurah:o.numberInSurah,surah:{number:o.surah.number,name:o.surah.name}}))};return te(s),s}catch{const n=C(e);return n?I(n):null}}function I(e){return{pageNumber:e.pageNumber,ayahs:e.ayahs.map(t=>({...t,text:_(t.text)}))}}function de(){const[e,t]=h.useState(typeof navigator<"u"?navigator.onLine:!0);return h.useEffect(()=>{const n=()=>t(!0),r=()=>t(!1);return window.addEventListener("online",n),window.addEventListener("offline",r),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}},[]),e}function ye(e,t){const[n,r]=h.useState(()=>({...t[0],dorarVerified:void 0})),[a,s]=h.useState(!0),[o,u]=h.useState(null);return h.useEffect(()=>{const c=t[e%t.length]??t[0];r({...c,dorarVerified:void 0}),s(!0),u(null);let i=!1;const l=e%42+1;return N("ara-nawawi",l).then(f=>{if(!i){if(f?.text){const d=p(f.source);r({...f,dorarVerified:d}),u(d?!0:null)}else r({...c,dorarVerified:void 0}),u(null);s(!1)}}),()=>{i=!0}},[e,t]),h.useEffect(()=>{if(!n?.text||a)return;if(p(n.source)){u(!0);return}let c=!1;return R(n.text).then(i=>{c||u(i.verified)}),()=>{c=!0}},[n?.text,n?.source,a]),{hadith:n,loading:a,dorarVerified:o}}export{ee as Q,ye as a,oe as b,ie as c,le as d,ue as e,ae as f,ce as g,$ as h,p as i,de as j,he as k,fe as p,_ as s,se as u,R as v};
